<!DOCTYPE html>
<html><head><meta content="width=device-width,initial-scale=1" name="viewport"/><meta charset="utf-8"/><link href="../../../../../style.css" rel="stylesheet" type="text/css"/></head><body><h1>CutBox.app</h1><h2>Coverage Report</h2><h4>Created: 2023-09-14 01:56</h4><div class="centered"><table><div class="source-name-title"><pre>.../Source/App/Services/History/HistoryService.swift</pre></div><tr><td><pre>Line</pre></td><td><pre>Count</pre></td><td><pre>Source (<a href="#L259">jump to first uncovered line</a>)</pre></td></tr><tr><td class="line-number"><a href="#L1" name="L1"><pre>1</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//</pre></td></tr><tr><td class="line-number"><a href="#L2" name="L2"><pre>2</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//  HistoryService.swift</pre></td></tr><tr><td class="line-number"><a href="#L3" name="L3"><pre>3</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//  CutBox</pre></td></tr><tr><td class="line-number"><a href="#L4" name="L4"><pre>4</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//</pre></td></tr><tr><td class="line-number"><a href="#L5" name="L5"><pre>5</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//  Created by Jason Milkins on 24/3/18.</pre></td></tr><tr><td class="line-number"><a href="#L6" name="L6"><pre>6</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//  Copyright Â© 2018-2023 ocodo. All rights reserved.</pre></td></tr><tr><td class="line-number"><a href="#L7" name="L7"><pre>7</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//</pre></td></tr><tr><td class="line-number"><a href="#L8" name="L8"><pre>8</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L9" name="L9"><pre>9</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>import SwiftyStringScore</pre></td></tr><tr><td class="line-number"><a href="#L10" name="L10"><pre>10</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>import RxSwift</pre></td></tr><tr><td class="line-number"><a href="#L11" name="L11"><pre>11</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L12" name="L12"><pre>12</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>protocol PasteboardWrapperType {</pre></td></tr><tr><td class="line-number"><a href="#L13" name="L13"><pre>13</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var pasteboardItems: [NSPasteboardItem]? { get }</pre></td></tr><tr><td class="line-number"><a href="#L14" name="L14"><pre>14</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>}</pre></td></tr><tr><td class="line-number"><a href="#L15" name="L15"><pre>15</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L16" name="L16"><pre>16</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>class PasteboardWrapper: PasteboardWrapperType {</pre></td></tr><tr><td class="line-number"><a href="#L17" name="L17"><pre>17</pre></a></td><td class="covered-line"><pre>26</pre></td><td class="code"><pre>    var pasteboardItems: [NSPasteboardItem]? {</pre></td></tr><tr><td class="line-number"><a href="#L18" name="L18"><pre>18</pre></a></td><td class="covered-line"><pre>26</pre></td><td class="code"><pre>        return NSPasteboard.general.pasteboardItems</pre></td></tr><tr><td class="line-number"><a href="#L19" name="L19"><pre>19</pre></a></td><td class="covered-line"><pre>26</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L20" name="L20"><pre>20</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>}</pre></td></tr><tr><td class="line-number"><a href="#L21" name="L21"><pre>21</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L22" name="L22"><pre>22</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>enum HistoryServiceEvents {</pre></td></tr><tr><td class="line-number"><a href="#L23" name="L23"><pre>23</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    case didSaveDefaults</pre></td></tr><tr><td class="line-number"><a href="#L24" name="L24"><pre>24</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    case didLoadDefaults</pre></td></tr><tr><td class="line-number"><a href="#L25" name="L25"><pre>25</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    case didClearHistory</pre></td></tr><tr><td class="line-number"><a href="#L26" name="L26"><pre>26</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>}</pre></td></tr><tr><td class="line-number"><a href="#L27" name="L27"><pre>27</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L28" name="L28"><pre>28</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>class HistoryService {</pre></td></tr><tr><td class="line-number"><a href="#L29" name="L29"><pre>29</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L30" name="L30"><pre>30</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    static let shared = HistoryService()</pre></td></tr><tr><td class="line-number"><a href="#L31" name="L31"><pre>31</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L32" name="L32"><pre>32</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>    let events = PublishSubject&lt;HistoryServiceEvents&gt;()</pre></td></tr><tr><td class="line-number"><a href="#L33" name="L33"><pre>33</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L34" name="L34"><pre>34</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    /// Data store wrapper</pre></td></tr><tr><td class="line-number"><a href="#L35" name="L35"><pre>35</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var historyRepo: HistoryRepo!</pre></td></tr><tr><td class="line-number"><a href="#L36" name="L36"><pre>36</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L37" name="L37"><pre>37</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var internalHistoryLimit: Int = 0</pre></td></tr><tr><td class="line-number"><a href="#L38" name="L38"><pre>38</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var historyLimit: Int {</pre></td></tr><tr><td class="line-number"><a href="#L39" name="L39"><pre>39</pre></a></td><td class="covered-line"><pre>341</pre></td><td class="code"><pre>        get {</pre></td></tr><tr><td class="line-number"><a href="#L40" name="L40"><pre>40</pre></a></td><td class="covered-line"><pre>341</pre></td><td class="code"><pre>            return internalHistoryLimit</pre></td></tr><tr><td class="line-number"><a href="#L41" name="L41"><pre>41</pre></a></td><td class="covered-line"><pre>341</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L42" name="L42"><pre>42</pre></a></td><td class="covered-line"><pre>4</pre></td><td class="code"><pre>        set {</pre></td></tr><tr><td class="line-number"><a href="#L43" name="L43"><pre>43</pre></a></td><td class="covered-line"><pre>4</pre></td><td class="code"><pre>            internalHistoryLimit = newValue</pre></td></tr><tr><td class="line-number"><a href="#L44" name="L44"><pre>44</pre></a></td><td class="covered-line"><pre>4</pre></td><td class="code"><pre>            self.truncateItems()</pre></td></tr><tr><td class="line-number"><a href="#L45" name="L45"><pre>45</pre></a></td><td class="covered-line"><pre>4</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L46" name="L46"><pre>46</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L47" name="L47"><pre>47</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L48" name="L48"><pre>48</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>    let disposeBag = DisposeBag()</pre></td></tr><tr><td class="line-number"><a href="#L49" name="L49"><pre>49</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L50" name="L50"><pre>50</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var defaults: UserDefaults</pre></td></tr><tr><td class="line-number"><a href="#L51" name="L51"><pre>51</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var pasteboard: PasteboardWrapperType</pre></td></tr><tr><td class="line-number"><a href="#L52" name="L52"><pre>52</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var pollingTimer: Timer?</pre></td></tr><tr><td class="line-number"><a href="#L53" name="L53"><pre>53</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var filterText: String? {</pre></td></tr><tr><td class="line-number"><a href="#L54" name="L54"><pre>54</pre></a></td><td class="covered-line"><pre>30</pre></td><td class="code"><pre>        didSet {</pre></td></tr><tr><td class="line-number"><a href="#L55" name="L55"><pre>55</pre></a></td><td class="covered-line"><pre>30</pre></td><td class="code"><pre>            invalidateCache()</pre></td></tr><tr><td class="line-number"><a href="#L56" name="L56"><pre>56</pre></a></td><td class="covered-line"><pre>30</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L57" name="L57"><pre>57</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L58" name="L58"><pre>58</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L59" name="L59"><pre>59</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var removeGuard: String?</pre></td></tr><tr><td class="line-number"><a href="#L60" name="L60"><pre>60</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L61" name="L61"><pre>61</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>    private var internalDefaultSearchmode: HistorySearchMode = .fuzzyMatch</pre></td></tr><tr><td class="line-number"><a href="#L62" name="L62"><pre>62</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L63" name="L63"><pre>63</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var searchMode: HistorySearchMode {</pre></td></tr><tr><td class="line-number"><a href="#L64" name="L64"><pre>64</pre></a></td><td class="covered-line"><pre>96</pre></td><td class="code"><pre>        get {</pre></td></tr><tr><td class="line-number"><a href="#L65" name="L65"><pre>65</pre></a></td><td class="covered-line"><pre>96</pre></td><td class="code"><pre>            if let rawValue = self.defaults.string(forKey: searchModeKey) {</pre></td></tr><tr><td class="line-number"><a href="#L66" name="L66"><pre>66</pre></a></td><td class="covered-line"><pre>17</pre></td><td class="code"><pre>                return HistorySearchMode.searchMode(from: rawValue)</pre></td></tr><tr><td class="line-number"><a href="#L67" name="L67"><pre>67</pre></a></td><td class="covered-line"><pre>79</pre></td><td class="code"><pre>            }</pre></td></tr><tr><td class="line-number"><a href="#L68" name="L68"><pre>68</pre></a></td><td class="covered-line"><pre>79</pre></td><td class="code"><pre>            return internalDefaultSearchmode</pre></td></tr><tr><td class="line-number"><a href="#L69" name="L69"><pre>69</pre></a></td><td class="covered-line"><pre>96</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L70" name="L70"><pre>70</pre></a></td><td class="covered-line"><pre>12</pre></td><td class="code"><pre>        set {</pre></td></tr><tr><td class="line-number"><a href="#L71" name="L71"><pre>71</pre></a></td><td class="covered-line"><pre>12</pre></td><td class="code"><pre>            self.defaults.set(newValue.rawValue, forKey: searchModeKey)</pre></td></tr><tr><td class="line-number"><a href="#L72" name="L72"><pre>72</pre></a></td><td class="covered-line"><pre>12</pre></td><td class="code"><pre>            invalidateCache()</pre></td></tr><tr><td class="line-number"><a href="#L73" name="L73"><pre>73</pre></a></td><td class="covered-line"><pre>12</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L74" name="L74"><pre>74</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L75" name="L75"><pre>75</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L76" name="L76"><pre>76</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var internalFavoritesOnly: Bool = false</pre></td></tr><tr><td class="line-number"><a href="#L77" name="L77"><pre>77</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var favoritesOnly: Bool {</pre></td></tr><tr><td class="line-number"><a href="#L78" name="L78"><pre>78</pre></a></td><td class="covered-line"><pre>161</pre></td><td class="code"><pre>        get { internalFavoritesOnly }</pre></td></tr><tr><td class="line-number"><a href="#L79" name="L79"><pre>79</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        set {</pre></td></tr><tr><td class="line-number"><a href="#L80" name="L80"><pre>80</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            internalFavoritesOnly = newValue</pre></td></tr><tr><td class="line-number"><a href="#L81" name="L81"><pre>81</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            self.defaults.set(newValue, forKey: searchFavoritesOnly)</pre></td></tr><tr><td class="line-number"><a href="#L82" name="L82"><pre>82</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            invalidateCache()</pre></td></tr><tr><td class="line-number"><a href="#L83" name="L83"><pre>83</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L84" name="L84"><pre>84</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L85" name="L85"><pre>85</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L86" name="L86"><pre>86</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    private var searchModeKey = "searchMode"</pre></td></tr><tr><td class="line-number"><a href="#L87" name="L87"><pre>87</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    private var searchFavoritesOnly = "searchFavoritesOnly"</pre></td></tr><tr><td class="line-number"><a href="#L88" name="L88"><pre>88</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    private var legacyHistoryStoreKey = "pasteStore"</pre></td></tr><tr><td class="line-number"><a href="#L89" name="L89"><pre>89</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L90" name="L90"><pre>90</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    @available(*, message: "HistoryService: .legacyHistoryStore is deprecated use .historyRepo")</pre></td></tr><tr><td class="line-number"><a href="#L91" name="L91"><pre>91</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>    private var legacyHistoryStore: [String]? = []</pre></td></tr><tr><td class="line-number"><a href="#L92" name="L92"><pre>92</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L93" name="L93"><pre>93</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    init(defaults: UserDefaults = UserDefaults.standard,</pre></td></tr><tr><td class="line-number"><a href="#L94" name="L94"><pre>94</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>         pasteboard: PasteboardWrapperType = PasteboardWrapper(),</pre></td></tr><tr><td class="line-number"><a href="#L95" name="L95"><pre>95</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>         historyRepo: HistoryRepo = HistoryRepo(defaults: UserDefaults.standard,</pre></td></tr><tr><td class="line-number"><a href="#L96" name="L96"><pre>96</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>                                                prefs: CutBoxPreferencesService.shared),</pre></td></tr><tr><td class="line-number"><a href="#L97" name="L97"><pre>97</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>         prefs: CutBoxPreferencesService = CutBoxPreferencesService.shared) {</pre></td></tr><tr><td class="line-number"><a href="#L98" name="L98"><pre>98</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L99" name="L99"><pre>99</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        self.defaults = defaults</pre></td></tr><tr><td class="line-number"><a href="#L100" name="L100"><pre>100</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        self.pasteboard = pasteboard</pre></td></tr><tr><td class="line-number"><a href="#L101" name="L101"><pre>101</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        self.historyRepo = historyRepo</pre></td></tr><tr><td class="line-number"><a href="#L102" name="L102"><pre>102</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L103" name="L103"><pre>103</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        // swiftlint:disable identifier_name</pre></td></tr><tr><td class="line-number"><a href="#L104" name="L104"><pre>104</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        let migration_1_6_x = HistoryStoreMigration_1_6_x(defaults: defaults)</pre></td></tr><tr><td class="line-number"><a href="#L105" name="L105"><pre>105</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        if migration_1_6_x.isMigrationRequired {</pre></td></tr><tr><td class="line-number"><a href="#L106" name="L106"><pre>106</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            migration_1_6_x.applyTimestampsToLegacyItems()</pre></td></tr><tr><td class="line-number"><a href="#L107" name="L107"><pre>107</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            print("historyStore migrated to 1.6.x - timestamps added")</pre></td></tr><tr><td class="line-number"><a href="#L108" name="L108"><pre>108</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L109" name="L109"><pre>109</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        // swiftlint:enable identifier_name</pre></td></tr><tr><td class="line-number"><a href="#L110" name="L110"><pre>110</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L111" name="L111"><pre>111</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        self.internalFavoritesOnly = self.defaults.bool(forKey: searchFavoritesOnly)</pre></td></tr><tr><td class="line-number"><a href="#L112" name="L112"><pre>112</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L113" name="L113"><pre>113</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        if let legacyHistoryStoreDefaults = defaults.array(forKey: self.legacyHistoryStoreKey) {</pre></td></tr><tr><td class="line-number"><a href="#L114" name="L114"><pre>114</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            self.migrateLegacyHistoryStore(legacyHistoryStoreDefaults, defaults)</pre></td></tr><tr><td class="line-number"><a href="#L115" name="L115"><pre>115</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        } else {</pre></td></tr><tr><td class="line-number"><a href="#L116" name="L116"><pre>116</pre></a></td><td class="covered-line"><pre>50</pre></td><td class="code"><pre>            self.historyRepo.loadFromDefaults()</pre></td></tr><tr><td class="line-number"><a href="#L117" name="L117"><pre>117</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L118" name="L118"><pre>118</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L119" name="L119"><pre>119</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>        self.events.onNext(.didLoadDefaults) // not currently used</pre></td></tr><tr><td class="line-number"><a href="#L120" name="L120"><pre>120</pre></a></td><td class="covered-line"><pre>51</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L121" name="L121"><pre>121</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L122" name="L122"><pre>122</pre></a></td><td class="covered-line"><pre>340</pre></td><td class="code"><pre>    private func truncateItems() {</pre></td></tr><tr><td class="line-number"><a href="#L123" name="L123"><pre>123</pre></a></td><td class="covered-line"><pre>340</pre></td><td class="code"><pre>        let limit = self.historyLimit</pre></td></tr><tr><td class="line-number"><a href="#L124" name="L124"><pre>124</pre></a></td><td class="covered-line"><pre>340</pre></td><td class="code"><pre>        if limit &gt; 0 &amp;&amp; historyRepo.items.count &gt; limit {</pre></td></tr><tr><td class="line-number"><a href="#L125" name="L125"><pre>125</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>            historyRepo.removeSubrange(limit..&lt;historyRepo.items.count)</pre></td></tr><tr><td class="line-number"><a href="#L126" name="L126"><pre>126</pre></a></td><td class="covered-line"><pre>340</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L127" name="L127"><pre>127</pre></a></td><td class="covered-line"><pre>340</pre></td><td class="code"><pre>        invalidateCache()</pre></td></tr><tr><td class="line-number"><a href="#L128" name="L128"><pre>128</pre></a></td><td class="covered-line"><pre>340</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L129" name="L129"><pre>129</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L130" name="L130"><pre>130</pre></a></td><td class="covered-line"><pre>395</pre></td><td class="code"><pre>    func invalidateCache() {</pre></td></tr><tr><td class="line-number"><a href="#L131" name="L131"><pre>131</pre></a></td><td class="covered-line"><pre>395</pre></td><td class="code"><pre>        itemsCache = nil</pre></td></tr><tr><td class="line-number"><a href="#L132" name="L132"><pre>132</pre></a></td><td class="covered-line"><pre>395</pre></td><td class="code"><pre>        dictCache = nil</pre></td></tr><tr><td class="line-number"><a href="#L133" name="L133"><pre>133</pre></a></td><td class="covered-line"><pre>395</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L134" name="L134"><pre>134</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L135" name="L135"><pre>135</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    private var itemsCache: [String]?</pre></td></tr><tr><td class="line-number"><a href="#L136" name="L136"><pre>136</pre></a></td><td class="covered-line"><pre>137</pre></td><td class="code"><pre>    var items: [String] {</pre></td></tr><tr><td class="line-number"><a href="#L137" name="L137"><pre>137</pre></a></td><td class="covered-line"><pre>137</pre></td><td class="code"><pre>        if let cached = itemsCache {</pre></td></tr><tr><td class="line-number"><a href="#L138" name="L138"><pre>138</pre></a></td><td class="covered-line"><pre>71</pre></td><td class="code"><pre>            return cached</pre></td></tr><tr><td class="line-number"><a href="#L139" name="L139"><pre>139</pre></a></td><td class="covered-line"><pre>71</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L140" name="L140"><pre>140</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L141" name="L141"><pre>141</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>        let historyItems: [String] =</pre></td></tr><tr><td class="line-number"><a href="#L142" name="L142"><pre>142</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>            self.favoritesOnly ?</pre></td></tr><tr><td class="line-number"><a href="#L143" name="L143"><pre>143</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>                historyRepo.favorites</pre></td></tr><tr><td class="line-number"><a href="#L144" name="L144"><pre>144</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>                : historyRepo.items</pre></td></tr><tr><td class="line-number"><a href="#L145" name="L145"><pre>145</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L146" name="L146"><pre>146</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>        let cache: [String]</pre></td></tr><tr><td class="line-number"><a href="#L147" name="L147"><pre>147</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>        if let search = self.filterText, !search.isEmpty {</pre></td></tr><tr><td class="line-number"><a href="#L148" name="L148"><pre>148</pre></a></td><td class="covered-line"><pre>8</pre></td><td class="code"><pre>            switch searchMode {</pre></td></tr><tr><td class="line-number"><a href="#L149" name="L149"><pre>149</pre></a></td><td class="covered-line"><pre>8</pre></td><td class="code"><pre>            case .fuzzyMatch:</pre></td></tr><tr><td class="line-number"><a href="#L150" name="L150"><pre>150</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>                cache = historyItems.fuzzySearchRankedFiltered(</pre></td></tr><tr><td class="line-number"><a href="#L151" name="L151"><pre>151</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>                    search: search,</pre></td></tr><tr><td class="line-number"><a href="#L152" name="L152"><pre>152</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>                    score: Constants.searchFuzzyMatchMinScore)</pre></td></tr><tr><td class="line-number"><a href="#L153" name="L153"><pre>153</pre></a></td><td class="covered-line"><pre>8</pre></td><td class="code"><pre>            case .regexpAnyCase:</pre></td></tr><tr><td class="line-number"><a href="#L154" name="L154"><pre>154</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                cache = historyItems.regexpSearchFiltered(</pre></td></tr><tr><td class="line-number"><a href="#L155" name="L155"><pre>155</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                    search: search,</pre></td></tr><tr><td class="line-number"><a href="#L156" name="L156"><pre>156</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                    options: [.caseInsensitive])</pre></td></tr><tr><td class="line-number"><a href="#L157" name="L157"><pre>157</pre></a></td><td class="covered-line"><pre>8</pre></td><td class="code"><pre>            case .regexpStrictCase:</pre></td></tr><tr><td class="line-number"><a href="#L158" name="L158"><pre>158</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                cache = historyItems.regexpSearchFiltered(</pre></td></tr><tr><td class="line-number"><a href="#L159" name="L159"><pre>159</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                    search: search,</pre></td></tr><tr><td class="line-number"><a href="#L160" name="L160"><pre>160</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                    options: [])</pre></td></tr><tr><td class="line-number"><a href="#L161" name="L161"><pre>161</pre></a></td><td class="covered-line"><pre>8</pre></td><td class="code"><pre>            case .substringMatch:</pre></td></tr><tr><td class="line-number"><a href="#L162" name="L162"><pre>162</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                cache = historyItems.substringSearchFiltered(</pre></td></tr><tr><td class="line-number"><a href="#L163" name="L163"><pre>163</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    search: search</pre></td></tr><tr><td class="line-number"><a href="#L164" name="L164"><pre>164</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                )</pre></td></tr><tr><td class="line-number"><a href="#L165" name="L165"><pre>165</pre></a></td><td class="covered-line"><pre>8</pre></td><td class="code"><pre>            }</pre></td></tr><tr><td class="line-number"><a href="#L166" name="L166"><pre>166</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>        } else {</pre></td></tr><tr><td class="line-number"><a href="#L167" name="L167"><pre>167</pre></a></td><td class="covered-line"><pre>58</pre></td><td class="code"><pre>            cache = historyItems</pre></td></tr><tr><td class="line-number"><a href="#L168" name="L168"><pre>168</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L169" name="L169"><pre>169</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L170" name="L170"><pre>170</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>        itemsCache = cache</pre></td></tr><tr><td class="line-number"><a href="#L171" name="L171"><pre>171</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>        return cache</pre></td></tr><tr><td class="line-number"><a href="#L172" name="L172"><pre>172</pre></a></td><td class="covered-line"><pre>66</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L173" name="L173"><pre>173</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L174" name="L174"><pre>174</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    private var dictCache: [[String: String]]?</pre></td></tr><tr><td class="line-number"><a href="#L175" name="L175"><pre>175</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>    var dict: [[String: String]] {</pre></td></tr><tr><td class="line-number"><a href="#L176" name="L176"><pre>176</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>        if let cached = dictCache {</pre></td></tr><tr><td class="line-number"><a href="#L177" name="L177"><pre>177</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            return cached</pre></td></tr><tr><td class="line-number"><a href="#L178" name="L178"><pre>178</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L179" name="L179"><pre>179</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L180" name="L180"><pre>180</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let historyItems: [[String: String]]!</pre></td></tr><tr><td class="line-number"><a href="#L181" name="L181"><pre>181</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        if self.favoritesOnly {</pre></td></tr><tr><td class="line-number"><a href="#L182" name="L182"><pre>182</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            historyItems = historyRepo.favoritesDict</pre></td></tr><tr><td class="line-number"><a href="#L183" name="L183"><pre>183</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        } else {</pre></td></tr><tr><td class="line-number"><a href="#L184" name="L184"><pre>184</pre></a></td><td class="covered-line"><pre>17</pre></td><td class="code"><pre>            historyItems = historyRepo.dict</pre></td></tr><tr><td class="line-number"><a href="#L185" name="L185"><pre>185</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L186" name="L186"><pre>186</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L187" name="L187"><pre>187</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let cache: [[String: String]]</pre></td></tr><tr><td class="line-number"><a href="#L188" name="L188"><pre>188</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        if let search = self.filterText, search != "" {</pre></td></tr><tr><td class="line-number"><a href="#L189" name="L189"><pre>189</pre></a></td><td class="covered-line"><pre>5</pre></td><td class="code"><pre>            switch searchMode {</pre></td></tr><tr><td class="line-number"><a href="#L190" name="L190"><pre>190</pre></a></td><td class="covered-line"><pre>5</pre></td><td class="code"><pre>            case .fuzzyMatch:</pre></td></tr><tr><td class="line-number"><a href="#L191" name="L191"><pre>191</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                cache = historyItems.fuzzySearchRankedFiltered(</pre></td></tr><tr><td class="line-number"><a href="#L192" name="L192"><pre>192</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    search: search,</pre></td></tr><tr><td class="line-number"><a href="#L193" name="L193"><pre>193</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    score: Constants.searchFuzzyMatchMinScore)</pre></td></tr><tr><td class="line-number"><a href="#L194" name="L194"><pre>194</pre></a></td><td class="covered-line"><pre>5</pre></td><td class="code"><pre>            case .regexpAnyCase:</pre></td></tr><tr><td class="line-number"><a href="#L195" name="L195"><pre>195</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                cache = historyItems.regexpSearchFiltered(</pre></td></tr><tr><td class="line-number"><a href="#L196" name="L196"><pre>196</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    search: search,</pre></td></tr><tr><td class="line-number"><a href="#L197" name="L197"><pre>197</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    options: [.caseInsensitive])</pre></td></tr><tr><td class="line-number"><a href="#L198" name="L198"><pre>198</pre></a></td><td class="covered-line"><pre>5</pre></td><td class="code"><pre>            case .regexpStrictCase:</pre></td></tr><tr><td class="line-number"><a href="#L199" name="L199"><pre>199</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                cache = historyItems.regexpSearchFiltered(</pre></td></tr><tr><td class="line-number"><a href="#L200" name="L200"><pre>200</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    search: search,</pre></td></tr><tr><td class="line-number"><a href="#L201" name="L201"><pre>201</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    options: [])</pre></td></tr><tr><td class="line-number"><a href="#L202" name="L202"><pre>202</pre></a></td><td class="covered-line"><pre>5</pre></td><td class="code"><pre>            case .substringMatch:</pre></td></tr><tr><td class="line-number"><a href="#L203" name="L203"><pre>203</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                cache = historyItems.substringSearchFiltered(</pre></td></tr><tr><td class="line-number"><a href="#L204" name="L204"><pre>204</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                    search: search</pre></td></tr><tr><td class="line-number"><a href="#L205" name="L205"><pre>205</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                )</pre></td></tr><tr><td class="line-number"><a href="#L206" name="L206"><pre>206</pre></a></td><td class="covered-line"><pre>5</pre></td><td class="code"><pre>            }</pre></td></tr><tr><td class="line-number"><a href="#L207" name="L207"><pre>207</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        } else {</pre></td></tr><tr><td class="line-number"><a href="#L208" name="L208"><pre>208</pre></a></td><td class="covered-line"><pre>14</pre></td><td class="code"><pre>            cache = historyItems</pre></td></tr><tr><td class="line-number"><a href="#L209" name="L209"><pre>209</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L210" name="L210"><pre>210</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L211" name="L211"><pre>211</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        dictCache = cache</pre></td></tr><tr><td class="line-number"><a href="#L212" name="L212"><pre>212</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        return cache</pre></td></tr><tr><td class="line-number"><a href="#L213" name="L213"><pre>213</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L214" name="L214"><pre>214</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L215" name="L215"><pre>215</pre></a></td><td class="covered-line"><pre>90</pre></td><td class="code"><pre>    var count: Int {</pre></td></tr><tr><td class="line-number"><a href="#L216" name="L216"><pre>216</pre></a></td><td class="covered-line"><pre>90</pre></td><td class="code"><pre>        return items.count</pre></td></tr><tr><td class="line-number"><a href="#L217" name="L217"><pre>217</pre></a></td><td class="covered-line"><pre>90</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L218" name="L218"><pre>218</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L219" name="L219"><pre>219</pre></a></td><td class="covered-line"><pre>40</pre></td><td class="code"><pre>    func beginPolling() {</pre></td></tr><tr><td class="line-number"><a href="#L220" name="L220"><pre>220</pre></a></td><td class="covered-line"><pre>40</pre></td><td class="code"><pre>        guard self.pollingTimer == nil else {</pre></td></tr><tr><td class="line-number"><a href="#L221" name="L221"><pre>221</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>            return</pre></td></tr><tr><td class="line-number"><a href="#L222" name="L222"><pre>222</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L223" name="L223"><pre>223</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L224" name="L224"><pre>224</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>        self.pollingTimer = Timer.scheduledTimer(</pre></td></tr><tr><td class="line-number"><a href="#L225" name="L225"><pre>225</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>            timeInterval: 0.2,</pre></td></tr><tr><td class="line-number"><a href="#L226" name="L226"><pre>226</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>            target: self,</pre></td></tr><tr><td class="line-number"><a href="#L227" name="L227"><pre>227</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>            selector: #selector(self.pollPasteboard),</pre></td></tr><tr><td class="line-number"><a href="#L228" name="L228"><pre>228</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>            userInfo: nil,</pre></td></tr><tr><td class="line-number"><a href="#L229" name="L229"><pre>229</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>            repeats: true)</pre></td></tr><tr><td class="line-number"><a href="#L230" name="L230"><pre>230</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L231" name="L231"><pre>231</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L232" name="L232"><pre>232</pre></a></td><td class="covered-line"><pre>31</pre></td><td class="code"><pre>    func endPolling() {</pre></td></tr><tr><td class="line-number"><a href="#L233" name="L233"><pre>233</pre></a></td><td class="covered-line"><pre>31</pre></td><td class="code"><pre>        guard self.pollingTimer != nil else {</pre></td></tr><tr><td class="line-number"><a href="#L234" name="L234"><pre>234</pre></a></td><td class="covered-line"><pre>29</pre></td><td class="code"><pre>            return</pre></td></tr><tr><td class="line-number"><a href="#L235" name="L235"><pre>235</pre></a></td><td class="covered-line"><pre>29</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L236" name="L236"><pre>236</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.pollingTimer?.invalidate()</pre></td></tr><tr><td class="line-number"><a href="#L237" name="L237"><pre>237</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.pollingTimer = nil</pre></td></tr><tr><td class="line-number"><a href="#L238" name="L238"><pre>238</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L239" name="L239"><pre>239</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L240" name="L240"><pre>240</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    @discardableResult</pre></td></tr><tr><td class="line-number"><a href="#L241" name="L241"><pre>241</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    func toggleSearchMode() -&gt; HistorySearchMode {</pre></td></tr><tr><td class="line-number"><a href="#L242" name="L242"><pre>242</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        self.searchMode = self.searchMode.next</pre></td></tr><tr><td class="line-number"><a href="#L243" name="L243"><pre>243</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        return self.searchMode</pre></td></tr><tr><td class="line-number"><a href="#L244" name="L244"><pre>244</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L245" name="L245"><pre>245</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L246" name="L246"><pre>246</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    func clear() {</pre></td></tr><tr><td class="line-number"><a href="#L247" name="L247"><pre>247</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.historyRepo.clearHistory()</pre></td></tr><tr><td class="line-number"><a href="#L248" name="L248"><pre>248</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.invalidateCache()</pre></td></tr><tr><td class="line-number"><a href="#L249" name="L249"><pre>249</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.events.onNext(.didClearHistory) // not currently used</pre></td></tr><tr><td class="line-number"><a href="#L250" name="L250"><pre>250</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L251" name="L251"><pre>251</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L252" name="L252"><pre>252</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    /// Clear history using timestamp predicate</pre></td></tr><tr><td class="line-number"><a href="#L253" name="L253"><pre>253</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    /// see historyOffsetPredicateFactory(offset: TimeInterval) -&gt; (String) -&gt; Bool</pre></td></tr><tr><td class="line-number"><a href="#L254" name="L254"><pre>254</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    func clearWithTimestampPredicate(predicate: (String) -&gt; Bool) {</pre></td></tr><tr><td class="line-number"><a href="#L255" name="L255"><pre>255</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.historyRepo.clearHistory(timestampPredicate: predicate)</pre></td></tr><tr><td class="line-number"><a href="#L256" name="L256"><pre>256</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.invalidateCache()</pre></td></tr><tr><td class="line-number"><a href="#L257" name="L257"><pre>257</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L258" name="L258"><pre>258</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L259" name="L259"><pre>259</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre>    func clearHistoryByTimeOffset(offset: TimeInterval) <span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L260" name="L260"><pre>260</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        if </span><span class="red">offset == 0</span><span class="red"> </span><span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L261" name="L261"><pre>261</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">            self.clear()</span></pre></td></tr><tr><td class="line-number"><a href="#L262" name="L262"><pre>262</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        }</span><span class="red"> else </span><span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L263" name="L263"><pre>263</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">            let predicate: (String) -&gt; Bool = historyOffsetPredicateFactory(offset: offset)</span></pre></td></tr><tr><td class="line-number"><a href="#L264" name="L264"><pre>264</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">            self.clearWithTimestampPredicate(predicate: predicate)</span></pre></td></tr><tr><td class="line-number"><a href="#L265" name="L265"><pre>265</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        }</span><span class="red"></span></pre></td></tr><tr><td class="line-number"><a href="#L266" name="L266"><pre>266</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">    }</span></pre></td></tr><tr><td class="line-number"><a href="#L267" name="L267"><pre>267</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L268" name="L268"><pre>268</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    private func itemSelectionToHistoryIndexes(selected: IndexSet) -&gt; IndexSet {</pre></td></tr><tr><td class="line-number"><a href="#L269" name="L269"><pre>269</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        return IndexSet(selected</pre></td></tr><tr><td class="line-number"><a href="#L270" name="L270"><pre>270</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>            .compactMap { self.items[safe: $0] }</pre></td></tr><tr><td class="line-number"><a href="#L271" name="L271"><pre>271</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>            .map { self.historyRepo.items.firstIndex(of: $0) }</pre></td></tr><tr><td class="line-number"><a href="#L272" name="L272"><pre>272</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>            .compactMap { $0 })</pre></td></tr><tr><td class="line-number"><a href="#L273" name="L273"><pre>273</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L274" name="L274"><pre>274</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L275" name="L275"><pre>275</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    private func itemSelectionToHistoryDictIndexes(selected: IndexSet) -&gt; IndexSet {</pre></td></tr><tr><td class="line-number"><a href="#L276" name="L276"><pre>276</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let storeStrings = historyRepo.dict.map { $0["string"] }</pre></td></tr><tr><td class="line-number"><a href="#L277" name="L277"><pre>277</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        let dictIndexes = IndexSet(</pre></td></tr><tr><td class="line-number"><a href="#L278" name="L278"><pre>278</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            selected.map {</pre></td></tr><tr><td class="line-number"><a href="#L279" name="L279"><pre>279</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                storeStrings</pre></td></tr><tr><td class="line-number"><a href="#L280" name="L280"><pre>280</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    .firstIndex(of: items[$0])!</pre></td></tr><tr><td class="line-number"><a href="#L281" name="L281"><pre>281</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            }</pre></td></tr><tr><td class="line-number"><a href="#L282" name="L282"><pre>282</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        )</pre></td></tr><tr><td class="line-number"><a href="#L283" name="L283"><pre>283</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        return dictIndexes</pre></td></tr><tr><td class="line-number"><a href="#L284" name="L284"><pre>284</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L285" name="L285"><pre>285</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L286" name="L286"><pre>286</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    func remove(selected: IndexSet) {</pre></td></tr><tr><td class="line-number"><a href="#L287" name="L287"><pre>287</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let indexes = itemSelectionToHistoryIndexes(selected: selected)</pre></td></tr><tr><td class="line-number"><a href="#L288" name="L288"><pre>288</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L289" name="L289"><pre>289</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        if indexes.contains(0) {</pre></td></tr><tr><td class="line-number"><a href="#L290" name="L290"><pre>290</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            self.removeGuard = self.historyRepo.items[0]</pre></td></tr><tr><td class="line-number"><a href="#L291" name="L291"><pre>291</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L292" name="L292"><pre>292</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L293" name="L293"><pre>293</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.historyRepo</pre></td></tr><tr><td class="line-number"><a href="#L294" name="L294"><pre>294</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            .removeAtIndexes(indexes: indexes)</pre></td></tr><tr><td class="line-number"><a href="#L295" name="L295"><pre>295</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.invalidateCache()</pre></td></tr><tr><td class="line-number"><a href="#L296" name="L296"><pre>296</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L297" name="L297"><pre>297</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L298" name="L298"><pre>298</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    func toggleFavorite(items: IndexSet) {</pre></td></tr><tr><td class="line-number"><a href="#L299" name="L299"><pre>299</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        let indexes = itemSelectionToHistoryDictIndexes(selected: items)</pre></td></tr><tr><td class="line-number"><a href="#L300" name="L300"><pre>300</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        self.historyRepo</pre></td></tr><tr><td class="line-number"><a href="#L301" name="L301"><pre>301</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            .toggleFavorite(indexes: indexes)</pre></td></tr><tr><td class="line-number"><a href="#L302" name="L302"><pre>302</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        self.invalidateCache()</pre></td></tr><tr><td class="line-number"><a href="#L303" name="L303"><pre>303</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L304" name="L304"><pre>304</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L305" name="L305"><pre>305</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>    func saveToDefaults() {</pre></td></tr><tr><td class="line-number"><a href="#L306" name="L306"><pre>306</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        self.historyRepo.saveToDefaults()</pre></td></tr><tr><td class="line-number"><a href="#L307" name="L307"><pre>307</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        self.events.onNext(.didSaveDefaults) // not currently used</pre></td></tr><tr><td class="line-number"><a href="#L308" name="L308"><pre>308</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L309" name="L309"><pre>309</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L310" name="L310"><pre>310</pre></a></td><td class="covered-line"><pre>30</pre></td><td class="code"><pre>    deinit {</pre></td></tr><tr><td class="line-number"><a href="#L311" name="L311"><pre>311</pre></a></td><td class="covered-line"><pre>30</pre></td><td class="code"><pre>        self.endPolling()</pre></td></tr><tr><td class="line-number"><a href="#L312" name="L312"><pre>312</pre></a></td><td class="covered-line"><pre>30</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L313" name="L313"><pre>313</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L314" name="L314"><pre>314</pre></a></td><td class="covered-line"><pre>362</pre></td><td class="code"><pre>    @objc func pollPasteboard() {</pre></td></tr><tr><td class="line-number"><a href="#L315" name="L315"><pre>315</pre></a></td><td class="covered-line"><pre>362</pre></td><td class="code"><pre>        let (clip, isFavorite) = self.replaceWithLatest()</pre></td></tr><tr><td class="line-number"><a href="#L316" name="L316"><pre>316</pre></a></td><td class="covered-line"><pre>362</pre></td><td class="code"><pre>        guard clip != nil else {</pre></td></tr><tr><td class="line-number"><a href="#L317" name="L317"><pre>317</pre></a></td><td class="covered-line"><pre>25</pre></td><td class="code"><pre>            return</pre></td></tr><tr><td class="line-number"><a href="#L318" name="L318"><pre>318</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L319" name="L319"><pre>319</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L320" name="L320"><pre>320</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        if clip!.isEmpty {</pre></td></tr><tr><td class="line-number"><a href="#L321" name="L321"><pre>321</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            self.removeLatest()</pre></td></tr><tr><td class="line-number"><a href="#L322" name="L322"><pre>322</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        } else {</pre></td></tr><tr><td class="line-number"><a href="#L323" name="L323"><pre>323</pre></a></td><td class="covered-line"><pre>336</pre></td><td class="code"><pre>            self.historyRepo.insert(clip!, isFavorite: isFavorite)</pre></td></tr><tr><td class="line-number"><a href="#L324" name="L324"><pre>324</pre></a></td><td class="covered-line"><pre>336</pre></td><td class="code"><pre>            self.truncateItems()</pre></td></tr><tr><td class="line-number"><a href="#L325" name="L325"><pre>325</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L326" name="L326"><pre>326</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        self.saveToDefaults()</pre></td></tr><tr><td class="line-number"><a href="#L327" name="L327"><pre>327</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L328" name="L328"><pre>328</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L329" name="L329"><pre>329</pre></a></td><td class="covered-line"><pre>362</pre></td><td class="code"><pre>    func replaceWithLatest() -&gt; (String?, Bool) {</pre></td></tr><tr><td class="line-number"><a href="#L330" name="L330"><pre>330</pre></a></td><td class="covered-line"><pre>362</pre></td><td class="code"><pre>        guard let currentClip = clipboardContent() else {</pre></td></tr><tr><td class="line-number"><a href="#L331" name="L331"><pre>331</pre></a></td><td class="covered-line"><pre>25</pre></td><td class="code"><pre>            return (nil, false)</pre></td></tr><tr><td class="line-number"><a href="#L332" name="L332"><pre>332</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L333" name="L333"><pre>333</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L334" name="L334"><pre>334</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        let isFavorite = historyRepo.favorites.contains(currentClip)</pre></td></tr><tr><td class="line-number"><a href="#L335" name="L335"><pre>335</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L336" name="L336"><pre>336</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        if let removeGuard = self.removeGuard,</pre></td></tr><tr><td class="line-number"><a href="#L337" name="L337"><pre>337</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>            currentClip == removeGuard <span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L338" name="L338"><pre>338</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">            return (nil, false)</span></pre></td></tr><tr><td class="line-number"><a href="#L339" name="L339"><pre>339</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre><span class="red">        }</span> else {</pre></td></tr><tr><td class="line-number"><a href="#L340" name="L340"><pre>340</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>            self.removeGuard = nil</pre></td></tr><tr><td class="line-number"><a href="#L341" name="L341"><pre>341</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L342" name="L342"><pre>342</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L343" name="L343"><pre>343</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        let indexes = historyRepo.findIndexSetOf(string: currentClip)</pre></td></tr><tr><td class="line-number"><a href="#L344" name="L344"><pre>344</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        if let indexOfClip = indexes.first {</pre></td></tr><tr><td class="line-number"><a href="#L345" name="L345"><pre>345</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            if indexOfClip == 0 <span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L346" name="L346"><pre>346</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">                return (nil, false)</span></pre></td></tr><tr><td class="line-number"><a href="#L347" name="L347"><pre>347</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre><span class="red">            }</span></pre></td></tr><tr><td class="line-number"><a href="#L348" name="L348"><pre>348</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            historyRepo.remove(at: indexOfClip)</pre></td></tr><tr><td class="line-number"><a href="#L349" name="L349"><pre>349</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L350" name="L350"><pre>350</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L351" name="L351"><pre>351</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        return (</pre></td></tr><tr><td class="line-number"><a href="#L352" name="L352"><pre>352</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>            historyRepo.items.first == currentClip</pre></td></tr><tr><td class="line-number"><a href="#L353" name="L353"><pre>353</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>            ? <span class="red">nil</span></pre></td></tr><tr><td class="line-number"><a href="#L354" name="L354"><pre>354</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>            : currentClip,</pre></td></tr><tr><td class="line-number"><a href="#L355" name="L355"><pre>355</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>            isFavorite</pre></td></tr><tr><td class="line-number"><a href="#L356" name="L356"><pre>356</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>        )</pre></td></tr><tr><td class="line-number"><a href="#L357" name="L357"><pre>357</pre></a></td><td class="covered-line"><pre>337</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L358" name="L358"><pre>358</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L359" name="L359"><pre>359</pre></a></td><td class="covered-line"><pre>363</pre></td><td class="code"><pre>    func clipboardContent() -&gt; String? {</pre></td></tr><tr><td class="line-number"><a href="#L360" name="L360"><pre>360</pre></a></td><td class="covered-line"><pre>363</pre></td><td class="code"><pre>        return pasteboard.pasteboardItems?</pre></td></tr><tr><td class="line-number"><a href="#L361" name="L361"><pre>361</pre></a></td><td class="covered-line"><pre>363</pre></td><td class="code"><pre>            .first?</pre></td></tr><tr><td class="line-number"><a href="#L362" name="L362"><pre>362</pre></a></td><td class="covered-line"><pre>363</pre></td><td class="code"><pre>            .string(forType: .string)</pre></td></tr><tr><td class="line-number"><a href="#L363" name="L363"><pre>363</pre></a></td><td class="covered-line"><pre>363</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L364" name="L364"><pre>364</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L365" name="L365"><pre>365</pre></a></td><td class="covered-line"><pre>40</pre></td><td class="code"><pre>    func historyMemorySize() -&gt; String {</pre></td></tr><tr><td class="line-number"><a href="#L366" name="L366"><pre>366</pre></a></td><td class="covered-line"><pre>40</pre></td><td class="code"><pre>        return self.historyRepo.bytesFormatted()</pre></td></tr><tr><td class="line-number"><a href="#L367" name="L367"><pre>367</pre></a></td><td class="covered-line"><pre>40</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L368" name="L368"><pre>368</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L369" name="L369"><pre>369</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    func removeLatest() {</pre></td></tr><tr><td class="line-number"><a href="#L370" name="L370"><pre>370</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        self.historyRepo.remove(at: 0)</pre></td></tr><tr><td class="line-number"><a href="#L371" name="L371"><pre>371</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        self.invalidateCache()</pre></td></tr><tr><td class="line-number"><a href="#L372" name="L372"><pre>372</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        NSPasteboard.general.clearContents()</pre></td></tr><tr><td class="line-number"><a href="#L373" name="L373"><pre>373</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        if let topClip = self.historyRepo.items.first {</pre></td></tr><tr><td class="line-number"><a href="#L374" name="L374"><pre>374</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            NSPasteboard.general.setString(topClip, forType: .string)</pre></td></tr><tr><td class="line-number"><a href="#L375" name="L375"><pre>375</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L376" name="L376"><pre>376</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L377" name="L377"><pre>377</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L378" name="L378"><pre>378</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    func setTimeFilter(seconds: Double?) {</pre></td></tr><tr><td class="line-number"><a href="#L379" name="L379"><pre>379</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.historyRepo.timeFilter = seconds</pre></td></tr><tr><td class="line-number"><a href="#L380" name="L380"><pre>380</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.invalidateCache()</pre></td></tr><tr><td class="line-number"><a href="#L381" name="L381"><pre>381</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        self.events.onNext(.didLoadDefaults) // not currently used</pre></td></tr><tr><td class="line-number"><a href="#L382" name="L382"><pre>382</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L383" name="L383"><pre>383</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L384" name="L384"><pre>384</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    func migrateLegacyHistoryStore(_ legacyHistoryStoreDefaults: [Any], _ defaults: UserDefaults) {</pre></td></tr><tr><td class="line-number"><a href="#L385" name="L385"><pre>385</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        self.legacyHistoryStore = legacyHistoryStoreDefaults as? [String]</pre></td></tr><tr><td class="line-number"><a href="#L386" name="L386"><pre>386</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        self.historyRepo.loadFromDefaults()</pre></td></tr><tr><td class="line-number"><a href="#L387" name="L387"><pre>387</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L388" name="L388"><pre>388</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        if let legacyHistoryStore = self.legacyHistoryStore {</pre></td></tr><tr><td class="line-number"><a href="#L389" name="L389"><pre>389</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            self.historyRepo.migrateLegacyPasteStore(legacyHistoryStore)</pre></td></tr><tr><td class="line-number"><a href="#L390" name="L390"><pre>390</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            self.historyRepo.saveToDefaults()</pre></td></tr><tr><td class="line-number"><a href="#L391" name="L391"><pre>391</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L392" name="L392"><pre>392</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L393" name="L393"><pre>393</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        defaults.removeObject(forKey: self.legacyHistoryStoreKey)</pre></td></tr><tr><td class="line-number"><a href="#L394" name="L394"><pre>394</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L395" name="L395"><pre>395</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>}</pre></td></tr></table></div></body></html>