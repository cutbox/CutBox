<!DOCTYPE html>
<html><head><meta content="width=device-width,initial-scale=1" name="viewport"/><meta charset="utf-8"/><link href="../../../../style.css" rel="stylesheet" type="text/css"/></head><body><h1>CutBox.app</h1><h2>Coverage Report</h2><h4>Created: 2023-09-11 17:44</h4><div class="centered"><table><div class="source-name-title"><pre>.../Source/App/Services/JSFuncService.swift</pre></div><tr><td><pre>Line</pre></td><td><pre>Count</pre></td><td><pre>Source (<a href="#L48">jump to first uncovered line</a>)</pre></td></tr><tr><td class="line-number"><a href="#L1" name="L1"><pre>1</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//</pre></td></tr><tr><td class="line-number"><a href="#L2" name="L2"><pre>2</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//  JSFuncService.swift</pre></td></tr><tr><td class="line-number"><a href="#L3" name="L3"><pre>3</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//  CutBox</pre></td></tr><tr><td class="line-number"><a href="#L4" name="L4"><pre>4</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//</pre></td></tr><tr><td class="line-number"><a href="#L5" name="L5"><pre>5</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//  Created by Jason Milkins on 17/5/18.</pre></td></tr><tr><td class="line-number"><a href="#L6" name="L6"><pre>6</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//  Copyright Â© 2018-2023 ocodo. All rights reserved.</pre></td></tr><tr><td class="line-number"><a href="#L7" name="L7"><pre>7</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>//</pre></td></tr><tr><td class="line-number"><a href="#L8" name="L8"><pre>8</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L9" name="L9"><pre>9</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>import JavaScriptCore</pre></td></tr><tr><td class="line-number"><a href="#L10" name="L10"><pre>10</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L11" name="L11"><pre>11</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>class JSFuncService: NSObject {</pre></td></tr><tr><td class="line-number"><a href="#L12" name="L12"><pre>12</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    static let shared = JSFuncService()</pre></td></tr><tr><td class="line-number"><a href="#L13" name="L13"><pre>13</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L14" name="L14"><pre>14</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>    let cutboxJSFilename: String = NSString(string: "~/.cutbox.js").expandingTildeInPath</pre></td></tr><tr><td class="line-number"><a href="#L15" name="L15"><pre>15</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L16" name="L16"><pre>16</pre></a></td><td class="covered-line"><pre>22</pre></td><td class="code"><pre>    let require: @convention(block) (String) -&gt; JSValue? = { path in</pre></td></tr><tr><td class="line-number"><a href="#L17" name="L17"><pre>17</pre></a></td><td class="covered-line"><pre>22</pre></td><td class="code"><pre>        let expandedPath = NSString(string: path).expandingTildeInPath</pre></td></tr><tr><td class="line-number"><a href="#L18" name="L18"><pre>18</pre></a></td><td class="covered-line"><pre>22</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L19" name="L19"><pre>19</pre></a></td><td class="covered-line"><pre>22</pre></td><td class="code"><pre>        guard FileManager.default.fileExists(atPath: expandedPath)</pre></td></tr><tr><td class="line-number"><a href="#L20" name="L20"><pre>20</pre></a></td><td class="covered-line"><pre>22</pre></td><td class="code"><pre>            else {</pre></td></tr><tr><td class="line-number"><a href="#L21" name="L21"><pre>21</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                notifyUser(</pre></td></tr><tr><td class="line-number"><a href="#L22" name="L22"><pre>22</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    title: "Require: filename \(expandedPath)",</pre></td></tr><tr><td class="line-number"><a href="#L23" name="L23"><pre>23</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    info: " does not exist")</pre></td></tr><tr><td class="line-number"><a href="#L24" name="L24"><pre>24</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                return nil</pre></td></tr><tr><td class="line-number"><a href="#L25" name="L25"><pre>25</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L26" name="L26"><pre>26</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L27" name="L27"><pre>27</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        guard let fileContent = getStringFromFile(expandedPath)</pre></td></tr><tr><td class="line-number"><a href="#L28" name="L28"><pre>28</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            else {</pre></td></tr><tr><td class="line-number"><a href="#L29" name="L29"><pre>29</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                notifyUser(</pre></td></tr><tr><td class="line-number"><a href="#L30" name="L30"><pre>30</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    title: "Cannot read: \(expandedPath)",</pre></td></tr><tr><td class="line-number"><a href="#L31" name="L31"><pre>31</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    info: "unknown error processing file")</pre></td></tr><tr><td class="line-number"><a href="#L32" name="L32"><pre>32</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                return nil</pre></td></tr><tr><td class="line-number"><a href="#L33" name="L33"><pre>33</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L34" name="L34"><pre>34</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L35" name="L35"><pre>35</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        return JSFuncService.shared.js.evaluateScript(fileContent)</pre></td></tr><tr><td class="line-number"><a href="#L36" name="L36"><pre>36</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    }</pre><div class="expansion-view"><div class="centered"><table><div class="source-name-title"><pre>$s15CutBoxUnitTests13JSFuncServiceC7requireySo7JSValueCSgSSXBvpfi</pre></div><tr><td><pre>Line</pre></td><td><pre>Count</pre></td><td><pre>Source</pre></td></tr><tr><td class="line-number"><a href="#L16" name="L16"><pre>16</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>    let require: @convention(block) (String) -&gt; JSValue? = { path in</pre></td></tr><tr><td class="line-number"><a href="#L17" name="L17"><pre>17</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let expandedPath = NSString(string: path).expandingTildeInPath</pre></td></tr><tr><td class="line-number"><a href="#L18" name="L18"><pre>18</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L19" name="L19"><pre>19</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        guard FileManager.default.fileExists(atPath: expandedPath)</pre></td></tr><tr><td class="line-number"><a href="#L20" name="L20"><pre>20</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>            else {</pre></td></tr><tr><td class="line-number"><a href="#L21" name="L21"><pre>21</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>                notifyUser(</pre></td></tr><tr><td class="line-number"><a href="#L22" name="L22"><pre>22</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>                    title: "Require: filename \(expandedPath)",</pre></td></tr><tr><td class="line-number"><a href="#L23" name="L23"><pre>23</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>                    info: " does not exist")</pre></td></tr><tr><td class="line-number"><a href="#L24" name="L24"><pre>24</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>                return nil</pre></td></tr><tr><td class="line-number"><a href="#L25" name="L25"><pre>25</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L26" name="L26"><pre>26</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L27" name="L27"><pre>27</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        guard let fileContent = getStringFromFile(expandedPath)</pre></td></tr><tr><td class="line-number"><a href="#L28" name="L28"><pre>28</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>            else {</pre></td></tr><tr><td class="line-number"><a href="#L29" name="L29"><pre>29</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>                notifyUser(</pre></td></tr><tr><td class="line-number"><a href="#L30" name="L30"><pre>30</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>                    title: "Cannot read: \(expandedPath)",</pre></td></tr><tr><td class="line-number"><a href="#L31" name="L31"><pre>31</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>                    info: "unknown error processing file")</pre></td></tr><tr><td class="line-number"><a href="#L32" name="L32"><pre>32</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>                return nil</pre></td></tr><tr><td class="line-number"><a href="#L33" name="L33"><pre>33</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L34" name="L34"><pre>34</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L35" name="L35"><pre>35</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        return JSFuncService.shared.js.evaluateScript(fileContent)</pre></td></tr><tr><td class="line-number"><a href="#L36" name="L36"><pre>36</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>    }</pre></td></tr></table></div></div><div class="expansion-view"><div class="centered"><table><div class="source-name-title"><pre>$s15CutBoxUnitTests13JSFuncServiceC7requireySo7JSValueCSgSSXBvpfiAGSScfU_</pre></div><tr><td><pre>Line</pre></td><td><pre>Count</pre></td><td><pre>Source</pre></td></tr><tr><td class="line-number"><a href="#L16" name="L16"><pre>16</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>    let require: @convention(block) (String) -&gt; JSValue? = { path in</pre></td></tr><tr><td class="line-number"><a href="#L17" name="L17"><pre>17</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>        let expandedPath = NSString(string: path).expandingTildeInPath</pre></td></tr><tr><td class="line-number"><a href="#L18" name="L18"><pre>18</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L19" name="L19"><pre>19</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>        guard FileManager.default.fileExists(atPath: expandedPath)</pre></td></tr><tr><td class="line-number"><a href="#L20" name="L20"><pre>20</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>            else {</pre></td></tr><tr><td class="line-number"><a href="#L21" name="L21"><pre>21</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                notifyUser(</pre></td></tr><tr><td class="line-number"><a href="#L22" name="L22"><pre>22</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    title: "Require: filename \(expandedPath)",</pre></td></tr><tr><td class="line-number"><a href="#L23" name="L23"><pre>23</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    info: " does not exist")</pre></td></tr><tr><td class="line-number"><a href="#L24" name="L24"><pre>24</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                return nil</pre></td></tr><tr><td class="line-number"><a href="#L25" name="L25"><pre>25</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L26" name="L26"><pre>26</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L27" name="L27"><pre>27</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        guard let fileContent = getStringFromFile(expandedPath)</pre></td></tr><tr><td class="line-number"><a href="#L28" name="L28"><pre>28</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            else {</pre></td></tr><tr><td class="line-number"><a href="#L29" name="L29"><pre>29</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                notifyUser(</pre></td></tr><tr><td class="line-number"><a href="#L30" name="L30"><pre>30</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    title: "Cannot read: \(expandedPath)",</pre></td></tr><tr><td class="line-number"><a href="#L31" name="L31"><pre>31</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                    info: "unknown error processing file")</pre></td></tr><tr><td class="line-number"><a href="#L32" name="L32"><pre>32</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                return nil</pre></td></tr><tr><td class="line-number"><a href="#L33" name="L33"><pre>33</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L34" name="L34"><pre>34</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L35" name="L35"><pre>35</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        return JSFuncService.shared.js.evaluateScript(fileContent)</pre></td></tr><tr><td class="line-number"><a href="#L36" name="L36"><pre>36</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    }</pre></td></tr></table></div></div></td></tr><tr><td class="line-number"><a href="#L37" name="L37"><pre>37</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L38" name="L38"><pre>38</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>    let shellCommand: @convention(block) (String) -&gt; String = { command in</pre></td></tr><tr><td class="line-number"><a href="#L39" name="L39"><pre>39</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>        let task = Process()</pre></td></tr><tr><td class="line-number"><a href="#L40" name="L40"><pre>40</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>        task.launchPath = "/bin/bash"</pre></td></tr><tr><td class="line-number"><a href="#L41" name="L41"><pre>41</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>        task.arguments = ["-c", command]</pre></td></tr><tr><td class="line-number"><a href="#L42" name="L42"><pre>42</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L43" name="L43"><pre>43</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>        let pipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L44" name="L44"><pre>44</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>        task.standardOutput = pipe</pre></td></tr><tr><td class="line-number"><a href="#L45" name="L45"><pre>45</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>        task.launch()</pre></td></tr><tr><td class="line-number"><a href="#L46" name="L46"><pre>46</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L47" name="L47"><pre>47</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>        let data = pipe.fileHandleForReading.readDataToEndOfFile()</pre></td></tr><tr><td class="line-number"><a href="#L48" name="L48"><pre>48</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>        return String(data: data, encoding: .utf8) ?? <span class="red">""</span></pre></td></tr><tr><td class="line-number"><a href="#L49" name="L49"><pre>49</pre></a></td><td class="covered-line"><pre>20</pre></td><td class="code"><pre>    }</pre><div class="expansion-view"><div class="centered"><table><div class="source-name-title"><pre>$s15CutBoxUnitTests13JSFuncServiceC12shellCommandyS2SXBvpfi</pre></div><tr><td><pre>Line</pre></td><td><pre>Count</pre></td><td><pre>Source</pre></td></tr><tr><td class="line-number"><a href="#L38" name="L38"><pre>38</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>    let shellCommand: @convention(block) (String) -&gt; String = { command in</pre></td></tr><tr><td class="line-number"><a href="#L39" name="L39"><pre>39</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let task = Process()</pre></td></tr><tr><td class="line-number"><a href="#L40" name="L40"><pre>40</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        task.launchPath = "/bin/bash"</pre></td></tr><tr><td class="line-number"><a href="#L41" name="L41"><pre>41</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        task.arguments = ["-c", command]</pre></td></tr><tr><td class="line-number"><a href="#L42" name="L42"><pre>42</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L43" name="L43"><pre>43</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let pipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L44" name="L44"><pre>44</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        task.standardOutput = pipe</pre></td></tr><tr><td class="line-number"><a href="#L45" name="L45"><pre>45</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        task.launch()</pre></td></tr><tr><td class="line-number"><a href="#L46" name="L46"><pre>46</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L47" name="L47"><pre>47</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let data = pipe.fileHandleForReading.readDataToEndOfFile()</pre></td></tr><tr><td class="line-number"><a href="#L48" name="L48"><pre>48</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        return String(data: data, encoding: .utf8) ?? ""</pre></td></tr><tr><td class="line-number"><a href="#L49" name="L49"><pre>49</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>    }</pre></td></tr></table></div></div><div class="expansion-view"><div class="centered"><table><div class="source-name-title"><pre>$s15CutBoxUnitTests13JSFuncServiceC12shellCommandyS2SXBvpfiS2ScfU_</pre></div><tr><td><pre>Line</pre></td><td><pre>Count</pre></td><td><pre>Source</pre></td></tr><tr><td class="line-number"><a href="#L38" name="L38"><pre>38</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    let shellCommand: @convention(block) (String) -&gt; String = { command in</pre></td></tr><tr><td class="line-number"><a href="#L39" name="L39"><pre>39</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        let task = Process()</pre></td></tr><tr><td class="line-number"><a href="#L40" name="L40"><pre>40</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        task.launchPath = "/bin/bash"</pre></td></tr><tr><td class="line-number"><a href="#L41" name="L41"><pre>41</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        task.arguments = ["-c", command]</pre></td></tr><tr><td class="line-number"><a href="#L42" name="L42"><pre>42</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L43" name="L43"><pre>43</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        let pipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L44" name="L44"><pre>44</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        task.standardOutput = pipe</pre></td></tr><tr><td class="line-number"><a href="#L45" name="L45"><pre>45</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        task.launch()</pre></td></tr><tr><td class="line-number"><a href="#L46" name="L46"><pre>46</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L47" name="L47"><pre>47</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        let data = pipe.fileHandleForReading.readDataToEndOfFile()</pre></td></tr><tr><td class="line-number"><a href="#L48" name="L48"><pre>48</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        return String(data: data, encoding: .utf8) ?? ""</pre></td></tr><tr><td class="line-number"><a href="#L49" name="L49"><pre>49</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    }</pre></td></tr></table></div></div></td></tr><tr><td class="line-number"><a href="#L50" name="L50"><pre>50</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L51" name="L51"><pre>51</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    let shell: @convention(block)</pre></td></tr><tr><td class="line-number"><a href="#L52" name="L52"><pre>52</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>    (String, String?) -&gt; [String] = { command, stdin -&gt; [String] in</pre></td></tr><tr><td class="line-number"><a href="#L53" name="L53"><pre>53</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>        let task = Process()</pre></td></tr><tr><td class="line-number"><a href="#L54" name="L54"><pre>54</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L55" name="L55"><pre>55</pre></a></td><td class="covered-line"><pre>21</pre></td><td class="code"><pre>        if let stdinString = stdin {</pre></td></tr><tr><td class="line-number"><a href="#L56" name="L56"><pre>56</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            let stdinPipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L57" name="L57"><pre>57</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            task.standardInput = stdinPipe</pre></td></tr><tr><td class="line-number"><a href="#L58" name="L58"><pre>58</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            if let stdinData = stdinString.data(using: .utf8) {</pre></td></tr><tr><td class="line-number"><a href="#L59" name="L59"><pre>59</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                stdinPipe.fileHandleForWriting.write(stdinData)</pre></td></tr><tr><td class="line-number"><a href="#L60" name="L60"><pre>60</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                stdinPipe.fileHandleForWriting.closeFile()</pre></td></tr><tr><td class="line-number"><a href="#L61" name="L61"><pre>61</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            }</pre></td></tr><tr><td class="line-number"><a href="#L62" name="L62"><pre>62</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L63" name="L63"><pre>63</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L64" name="L64"><pre>64</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        task.launchPath = "/bin/bash"</pre></td></tr><tr><td class="line-number"><a href="#L65" name="L65"><pre>65</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        task.arguments = ["-c", command]</pre></td></tr><tr><td class="line-number"><a href="#L66" name="L66"><pre>66</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L67" name="L67"><pre>67</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stdoutPipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L68" name="L68"><pre>68</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stderrPipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L69" name="L69"><pre>69</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        task.standardOutput = stdoutPipe</pre></td></tr><tr><td class="line-number"><a href="#L70" name="L70"><pre>70</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        task.standardError = stderrPipe</pre></td></tr><tr><td class="line-number"><a href="#L71" name="L71"><pre>71</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L72" name="L72"><pre>72</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        do {</pre></td></tr><tr><td class="line-number"><a href="#L73" name="L73"><pre>73</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            try task.run()</pre></td></tr><tr><td class="line-number"><a href="#L74" name="L74"><pre>74</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        } catch <span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L75" name="L75"><pre>75</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">            return ["", "Error running: shell(command: \(command), stdin: \(String(describing: stdin))"]</span></pre></td></tr><tr><td class="line-number"><a href="#L76" name="L76"><pre>76</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre><span class="red">        }</span></pre></td></tr><tr><td class="line-number"><a href="#L77" name="L77"><pre>77</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L78" name="L78"><pre>78</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stdoutData = stdoutPipe.fileHandleForReading.readDataToEndOfFile()</pre></td></tr><tr><td class="line-number"><a href="#L79" name="L79"><pre>79</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stderrData = stderrPipe.fileHandleForReading.readDataToEndOfFile()</pre></td></tr><tr><td class="line-number"><a href="#L80" name="L80"><pre>80</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L81" name="L81"><pre>81</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stdout = String(data: stdoutData, encoding: .utf8) ?? <span class="red">""</span></pre></td></tr><tr><td class="line-number"><a href="#L82" name="L82"><pre>82</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stderr = String(data: stderrData, encoding: .utf8) ?? <span class="red">""</span></pre></td></tr><tr><td class="line-number"><a href="#L83" name="L83"><pre>83</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L84" name="L84"><pre>84</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        return [stdout, stderr]</pre></td></tr><tr><td class="line-number"><a href="#L85" name="L85"><pre>85</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    }</pre><div class="expansion-view"><div class="centered"><table><div class="source-name-title"><pre>$s15CutBoxUnitTests13JSFuncServiceC5shellySaySSGSS_SSSgtXBvpfi</pre></div><tr><td><pre>Line</pre></td><td><pre>Count</pre></td><td><pre>Source</pre></td></tr><tr><td class="line-number"><a href="#L52" name="L52"><pre>52</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>    (String, String?) -&gt; [String] = { command, stdin -&gt; [String] in</pre></td></tr><tr><td class="line-number"><a href="#L53" name="L53"><pre>53</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let task = Process()</pre></td></tr><tr><td class="line-number"><a href="#L54" name="L54"><pre>54</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L55" name="L55"><pre>55</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        if let stdinString = stdin {</pre></td></tr><tr><td class="line-number"><a href="#L56" name="L56"><pre>56</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>            let stdinPipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L57" name="L57"><pre>57</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>            task.standardInput = stdinPipe</pre></td></tr><tr><td class="line-number"><a href="#L58" name="L58"><pre>58</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>            if let stdinData = stdinString.data(using: .utf8) {</pre></td></tr><tr><td class="line-number"><a href="#L59" name="L59"><pre>59</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>                stdinPipe.fileHandleForWriting.write(stdinData)</pre></td></tr><tr><td class="line-number"><a href="#L60" name="L60"><pre>60</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>                stdinPipe.fileHandleForWriting.closeFile()</pre></td></tr><tr><td class="line-number"><a href="#L61" name="L61"><pre>61</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>            }</pre></td></tr><tr><td class="line-number"><a href="#L62" name="L62"><pre>62</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L63" name="L63"><pre>63</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L64" name="L64"><pre>64</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        task.launchPath = "/bin/bash"</pre></td></tr><tr><td class="line-number"><a href="#L65" name="L65"><pre>65</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        task.arguments = ["-c", command]</pre></td></tr><tr><td class="line-number"><a href="#L66" name="L66"><pre>66</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L67" name="L67"><pre>67</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let stdoutPipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L68" name="L68"><pre>68</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let stderrPipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L69" name="L69"><pre>69</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        task.standardOutput = stdoutPipe</pre></td></tr><tr><td class="line-number"><a href="#L70" name="L70"><pre>70</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        task.standardError = stderrPipe</pre></td></tr><tr><td class="line-number"><a href="#L71" name="L71"><pre>71</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L72" name="L72"><pre>72</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        do {</pre></td></tr><tr><td class="line-number"><a href="#L73" name="L73"><pre>73</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>            try task.run()</pre></td></tr><tr><td class="line-number"><a href="#L74" name="L74"><pre>74</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        } catch {</pre></td></tr><tr><td class="line-number"><a href="#L75" name="L75"><pre>75</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>            return ["", "Error running: shell(command: \(command), stdin: \(String(describing: stdin))"]</pre></td></tr><tr><td class="line-number"><a href="#L76" name="L76"><pre>76</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L77" name="L77"><pre>77</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L78" name="L78"><pre>78</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let stdoutData = stdoutPipe.fileHandleForReading.readDataToEndOfFile()</pre></td></tr><tr><td class="line-number"><a href="#L79" name="L79"><pre>79</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let stderrData = stderrPipe.fileHandleForReading.readDataToEndOfFile()</pre></td></tr><tr><td class="line-number"><a href="#L80" name="L80"><pre>80</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L81" name="L81"><pre>81</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let stdout = String(data: stdoutData, encoding: .utf8) ?? ""</pre></td></tr><tr><td class="line-number"><a href="#L82" name="L82"><pre>82</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        let stderr = String(data: stderrData, encoding: .utf8) ?? ""</pre></td></tr><tr><td class="line-number"><a href="#L83" name="L83"><pre>83</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L84" name="L84"><pre>84</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>        return [stdout, stderr]</pre></td></tr><tr><td class="line-number"><a href="#L85" name="L85"><pre>85</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>    }</pre></td></tr></table></div></div><div class="expansion-view"><div class="centered"><table><div class="source-name-title"><pre>$s15CutBoxUnitTests13JSFuncServiceC5shellySaySSGSS_SSSgtXBvpfiAESS_AFtcfU_</pre></div><tr><td><pre>Line</pre></td><td><pre>Count</pre></td><td><pre>Source</pre></td></tr><tr><td class="line-number"><a href="#L52" name="L52"><pre>52</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    (String, String?) -&gt; [String] = { command, stdin -&gt; [String] in</pre></td></tr><tr><td class="line-number"><a href="#L53" name="L53"><pre>53</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let task = Process()</pre></td></tr><tr><td class="line-number"><a href="#L54" name="L54"><pre>54</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L55" name="L55"><pre>55</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        if let stdinString = stdin {</pre></td></tr><tr><td class="line-number"><a href="#L56" name="L56"><pre>56</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            let stdinPipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L57" name="L57"><pre>57</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            task.standardInput = stdinPipe</pre></td></tr><tr><td class="line-number"><a href="#L58" name="L58"><pre>58</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            if let stdinData = stdinString.data(using: .utf8) {</pre></td></tr><tr><td class="line-number"><a href="#L59" name="L59"><pre>59</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                stdinPipe.fileHandleForWriting.write(stdinData)</pre></td></tr><tr><td class="line-number"><a href="#L60" name="L60"><pre>60</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>                stdinPipe.fileHandleForWriting.closeFile()</pre></td></tr><tr><td class="line-number"><a href="#L61" name="L61"><pre>61</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            }</pre></td></tr><tr><td class="line-number"><a href="#L62" name="L62"><pre>62</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L63" name="L63"><pre>63</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L64" name="L64"><pre>64</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        task.launchPath = "/bin/bash"</pre></td></tr><tr><td class="line-number"><a href="#L65" name="L65"><pre>65</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        task.arguments = ["-c", command]</pre></td></tr><tr><td class="line-number"><a href="#L66" name="L66"><pre>66</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L67" name="L67"><pre>67</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stdoutPipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L68" name="L68"><pre>68</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stderrPipe = Pipe()</pre></td></tr><tr><td class="line-number"><a href="#L69" name="L69"><pre>69</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        task.standardOutput = stdoutPipe</pre></td></tr><tr><td class="line-number"><a href="#L70" name="L70"><pre>70</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        task.standardError = stderrPipe</pre></td></tr><tr><td class="line-number"><a href="#L71" name="L71"><pre>71</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L72" name="L72"><pre>72</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        do {</pre></td></tr><tr><td class="line-number"><a href="#L73" name="L73"><pre>73</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>            try task.run()</pre></td></tr><tr><td class="line-number"><a href="#L74" name="L74"><pre>74</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        } catch <span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L75" name="L75"><pre>75</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">            return ["", "Error running: shell(command: \(command), stdin: \(String(describing: stdin))"]</span></pre></td></tr><tr><td class="line-number"><a href="#L76" name="L76"><pre>76</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre><span class="red">        }</span></pre></td></tr><tr><td class="line-number"><a href="#L77" name="L77"><pre>77</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L78" name="L78"><pre>78</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stdoutData = stdoutPipe.fileHandleForReading.readDataToEndOfFile()</pre></td></tr><tr><td class="line-number"><a href="#L79" name="L79"><pre>79</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stderrData = stderrPipe.fileHandleForReading.readDataToEndOfFile()</pre></td></tr><tr><td class="line-number"><a href="#L80" name="L80"><pre>80</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L81" name="L81"><pre>81</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stdout = String(data: stdoutData, encoding: .utf8) ?? ""</pre></td></tr><tr><td class="line-number"><a href="#L82" name="L82"><pre>82</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        let stderr = String(data: stderrData, encoding: .utf8) ?? ""</pre></td></tr><tr><td class="line-number"><a href="#L83" name="L83"><pre>83</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L84" name="L84"><pre>84</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        return [stdout, stderr]</pre></td></tr><tr><td class="line-number"><a href="#L85" name="L85"><pre>85</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>    }</pre></td></tr></table></div></div></td></tr><tr><td class="line-number"><a href="#L86" name="L86"><pre>86</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L87" name="L87"><pre>87</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var filterText: String = ""</pre></td></tr><tr><td class="line-number"><a href="#L88" name="L88"><pre>88</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L89" name="L89"><pre>89</pre></a></td><td class="covered-line"><pre>8</pre></td><td class="code"><pre>    var funcs: [(String, Int)] {</pre></td></tr><tr><td class="line-number"><a href="#L90" name="L90"><pre>90</pre></a></td><td class="covered-line"><pre>8</pre></td><td class="code"><pre>        guard let funcsDict: [[String: Any]] = js["cutboxFunctions"]</pre></td></tr><tr><td class="line-number"><a href="#L91" name="L91"><pre>91</pre></a></td><td class="covered-line"><pre>8</pre></td><td class="code"><pre>            .toArray() as? [[String: Any]] else {</pre></td></tr><tr><td class="line-number"><a href="#L92" name="L92"><pre>92</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>                return []</pre></td></tr><tr><td class="line-number"><a href="#L93" name="L93"><pre>93</pre></a></td><td class="covered-line"><pre>7</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L94" name="L94"><pre>94</pre></a></td><td class="covered-line"><pre>7</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L95" name="L95"><pre>95</pre></a></td><td class="covered-line"><pre>7</pre></td><td class="code"><pre>        var idx = 0</pre></td></tr><tr><td class="line-number"><a href="#L96" name="L96"><pre>96</pre></a></td><td class="covered-line"><pre>9</pre></td><td class="code"><pre>        return funcsDict.map { (dict: [String: Any]) -&gt; (String, Int) in</pre></td></tr><tr><td class="line-number"><a href="#L97" name="L97"><pre>97</pre></a></td><td class="covered-line"><pre>9</pre></td><td class="code"><pre>            guard let name = dict["name"] as? String else <span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L98" name="L98"><pre>98</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">                fatalError(</span><span class="red">"cutboxFunctions invalid: requires an array of {name: String, fn: Function}"</span><span class="red">)</span></pre></td></tr><tr><td class="line-number"><a href="#L99" name="L99"><pre>99</pre></a></td><td class="covered-line"><pre>9</pre></td><td class="code"><pre><span class="red">            }</span></pre></td></tr><tr><td class="line-number"><a href="#L100" name="L100"><pre>100</pre></a></td><td class="covered-line"><pre>9</pre></td><td class="code"><pre>            let index = (name, idx)</pre></td></tr><tr><td class="line-number"><a href="#L101" name="L101"><pre>101</pre></a></td><td class="covered-line"><pre>9</pre></td><td class="code"><pre>            idx += 1</pre></td></tr><tr><td class="line-number"><a href="#L102" name="L102"><pre>102</pre></a></td><td class="covered-line"><pre>9</pre></td><td class="code"><pre>            return index</pre></td></tr><tr><td class="line-number"><a href="#L103" name="L103"><pre>103</pre></a></td><td class="covered-line"><pre>9</pre></td><td class="code"><pre>        }</pre></td></tr><tr><td class="line-number"><a href="#L104" name="L104"><pre>104</pre></a></td><td class="covered-line"><pre>8</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L105" name="L105"><pre>105</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L106" name="L106"><pre>106</pre></a></td><td class="covered-line"><pre>5</pre></td><td class="code"><pre>    var funcList: [String] {</pre></td></tr><tr><td class="line-number"><a href="#L107" name="L107"><pre>107</pre></a></td><td class="covered-line"><pre>5</pre></td><td class="code"><pre>        let names: [String] = funcs.map { (t: (String, Int)) -&gt; String in t.0 }</pre></td></tr><tr><td class="line-number"><a href="#L108" name="L108"><pre>108</pre></a></td><td class="covered-line"><pre>5</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L109" name="L109"><pre>109</pre></a></td><td class="covered-line"><pre>5</pre></td><td class="code"><pre>        if filterText.isEmpty {</pre></td></tr><tr><td class="line-number"><a href="#L110" name="L110"><pre>110</pre></a></td><td class="covered-line"><pre>4</pre></td><td class="code"><pre>            return names</pre></td></tr><tr><td class="line-number"><a href="#L111" name="L111"><pre>111</pre></a></td><td class="covered-line"><pre>4</pre></td><td class="code"><pre>        } else {</pre></td></tr><tr><td class="line-number"><a href="#L112" name="L112"><pre>112</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            return names.substringSearchFiltered(search: filterText)</pre></td></tr><tr><td class="line-number"><a href="#L113" name="L113"><pre>113</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        }<span class="red"></span></pre></td></tr><tr><td class="line-number"><a href="#L114" name="L114"><pre>114</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">    }</span></pre></td></tr><tr><td class="line-number"><a href="#L115" name="L115"><pre>115</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L116" name="L116"><pre>116</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    func selected(name: String) -&gt; (String, Int)? {</pre></td></tr><tr><td class="line-number"><a href="#L117" name="L117"><pre>117</pre></a></td><td class="covered-line"><pre>2</pre></td><td class="code"><pre>        guard let found = funcs.first(where: { $0.0 == name })</pre></td></tr><tr><td class="line-number"><a href="#L118" name="L118"><pre>118</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            else <span class="red">{ return nil }</span></pre></td></tr><tr><td class="line-number"><a href="#L119" name="L119"><pre>119</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        return found</pre></td></tr><tr><td class="line-number"><a href="#L120" name="L120"><pre>120</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L121" name="L121"><pre>121</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L122" name="L122"><pre>122</pre></a></td><td class="covered-line"><pre>19</pre></td><td class="code"><pre>    var js: JSContext = JSContext()</pre></td></tr><tr><td class="line-number"><a href="#L123" name="L123"><pre>123</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L124" name="L124"><pre>124</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    var count: Int {</pre></td></tr><tr><td class="line-number"><a href="#L125" name="L125"><pre>125</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        return self.funcList.count</pre></td></tr><tr><td class="line-number"><a href="#L126" name="L126"><pre>126</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L127" name="L127"><pre>127</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L128" name="L128"><pre>128</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    var isEmpty: Bool {</pre></td></tr><tr><td class="line-number"><a href="#L129" name="L129"><pre>129</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        return self.funcList.isEmpty</pre></td></tr><tr><td class="line-number"><a href="#L130" name="L130"><pre>130</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L131" name="L131"><pre>131</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L132" name="L132"><pre>132</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var helpers = """</pre></td></tr><tr><td class="line-number"><a href="#L133" name="L133"><pre>133</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        help = `</pre></td></tr><tr><td class="line-number"><a href="#L134" name="L134"><pre>134</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        CutBox JS Help:</pre></td></tr><tr><td class="line-number"><a href="#L135" name="L135"><pre>135</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>          cutboxFunctions - Array of loaded functions</pre></td></tr><tr><td class="line-number"><a href="#L136" name="L136"><pre>136</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L137" name="L137"><pre>137</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        ${ls()}`</pre></td></tr><tr><td class="line-number"><a href="#L138" name="L138"><pre>138</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L139" name="L139"><pre>139</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        var ls = () =&gt; cutboxFunctions.map(e =&gt; e.name).join(`\n`)</pre></td></tr><tr><td class="line-number"><a href="#L140" name="L140"><pre>140</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        var list = () =&gt; JSON.stringify(cutboxFunctions, null, 2)</pre></td></tr><tr><td class="line-number"><a href="#L141" name="L141"><pre>141</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        """</pre></td></tr><tr><td class="line-number"><a href="#L142" name="L142"><pre>142</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L143" name="L143"><pre>143</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>    var noCutboxJSHelp = """</pre></td></tr><tr><td class="line-number"><a href="#L144" name="L144"><pre>144</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        var help = `CutBox JS Help:\n</pre></td></tr><tr><td class="line-number"><a href="#L145" name="L145"><pre>145</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>          ~/.cutbox.js does not exist\n</pre></td></tr><tr><td class="line-number"><a href="#L146" name="L146"><pre>146</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        Add and reload to paste through JS.</pre></td></tr><tr><td class="line-number"><a href="#L147" name="L147"><pre>147</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        See the wiki for more advanced info:</pre></td></tr><tr><td class="line-number"><a href="#L148" name="L148"><pre>148</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        https://github.com/cutbox/CutBox/wiki`</pre></td></tr><tr><td class="line-number"><a href="#L149" name="L149"><pre>149</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>        """</pre></td></tr><tr><td class="line-number"><a href="#L150" name="L150"><pre>150</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L151" name="L151"><pre>151</pre></a></td><td class="covered-line"><pre>18</pre></td><td class="code"><pre>    func setup() {</pre></td></tr><tr><td class="line-number"><a href="#L152" name="L152"><pre>152</pre></a></td><td class="covered-line"><pre>18</pre></td><td class="code"><pre>        self.js = JSContext()</pre></td></tr><tr><td class="line-number"><a href="#L153" name="L153"><pre>153</pre></a></td><td class="covered-line"><pre>18</pre></td><td class="code"><pre>        self.js["require"] = self.require</pre></td></tr><tr><td class="line-number"><a href="#L154" name="L154"><pre>154</pre></a></td><td class="covered-line"><pre>18</pre></td><td class="code"><pre>        self.js["shellCommand"] = self.shellCommand</pre></td></tr><tr><td class="line-number"><a href="#L155" name="L155"><pre>155</pre></a></td><td class="covered-line"><pre>18</pre></td><td class="code"><pre>        self.js["shell"] = self.shell</pre></td></tr><tr><td class="line-number"><a href="#L156" name="L156"><pre>156</pre></a></td><td class="covered-line"><pre>18</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L157" name="L157"><pre>157</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L158" name="L158"><pre>158</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    func reload() {</pre></td></tr><tr><td class="line-number"><a href="#L159" name="L159"><pre>159</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        setup()</pre></td></tr><tr><td class="line-number"><a href="#L160" name="L160"><pre>160</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L161" name="L161"><pre>161</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        _ = repl(noCutboxJSHelp)</pre></td></tr><tr><td class="line-number"><a href="#L162" name="L162"><pre>162</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L163" name="L163"><pre>163</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        guard let cutboxJS = getStringFromFile(cutboxJSFilename) else {</pre></td></tr><tr><td class="line-number"><a href="#L164" name="L164"><pre>164</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>            return</pre></td></tr><tr><td class="line-number"><a href="#L165" name="L165"><pre>165</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        }<span class="red"></span></pre></td></tr><tr><td class="line-number"><a href="#L166" name="L166"><pre>166</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red"></span></pre></td></tr><tr><td class="line-number"><a href="#L167" name="L167"><pre>167</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        _ = repl(helpers)</span></pre></td></tr><tr><td class="line-number"><a href="#L168" name="L168"><pre>168</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        _ = repl(cutboxJS)</span></pre></td></tr><tr><td class="line-number"><a href="#L169" name="L169"><pre>169</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red"></span></pre></td></tr><tr><td class="line-number"><a href="#L170" name="L170"><pre>170</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        if </span><span class="red">self.isEmpty</span><span class="red"> </span><span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L171" name="L171"><pre>171</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">            notifyUser(title: "Problem with ~/.cutbox.js",</span></pre></td></tr><tr><td class="line-number"><a href="#L172" name="L172"><pre>172</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">                       info: "cutboxFunctions has no functions")</span></pre></td></tr><tr><td class="line-number"><a href="#L173" name="L173"><pre>173</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        }</span><span class="red"> else </span><span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L174" name="L174"><pre>174</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">            notifyUser(title: "Javascript loaded",</span></pre></td></tr><tr><td class="line-number"><a href="#L175" name="L175"><pre>175</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">                       info: "~/.cutbox.js loaded \(self.count) function(s)")</span></pre></td></tr><tr><td class="line-number"><a href="#L176" name="L176"><pre>176</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        }</span><span class="red"></span></pre></td></tr><tr><td class="line-number"><a href="#L177" name="L177"><pre>177</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">    }</span></pre></td></tr><tr><td class="line-number"><a href="#L178" name="L178"><pre>178</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L179" name="L179"><pre>179</pre></a></td><td class="covered-line"><pre>27</pre></td><td class="code"><pre>    func repl(_ line: String) -&gt; String {</pre></td></tr><tr><td class="line-number"><a href="#L180" name="L180"><pre>180</pre></a></td><td class="covered-line"><pre>27</pre></td><td class="code"><pre>        return js.evaluateScript(line).toString()</pre></td></tr><tr><td class="line-number"><a href="#L181" name="L181"><pre>181</pre></a></td><td class="covered-line"><pre>27</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L182" name="L182"><pre>182</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L183" name="L183"><pre>183</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    func replValue(_ line: String) -&gt; JSValue? {</pre></td></tr><tr><td class="line-number"><a href="#L184" name="L184"><pre>184</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>        return js.evaluateScript(line)</pre></td></tr><tr><td class="line-number"><a href="#L185" name="L185"><pre>185</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    }</pre></td></tr><tr><td class="line-number"><a href="#L186" name="L186"><pre>186</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L187" name="L187"><pre>187</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre>    func process(_ name: String, items: [String]) -&gt; String <span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L188" name="L188"><pre>188</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        guard let index = selected(name: name)?.1</span></pre></td></tr><tr><td class="line-number"><a href="#L189" name="L189"><pre>189</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">            else </span><span class="red">{ return "" }</span><span class="red"></span></pre></td></tr><tr><td class="line-number"><a href="#L190" name="L190"><pre>190</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        return self.process(index, items: items)</span><span class="red"></span></pre></td></tr><tr><td class="line-number"><a href="#L191" name="L191"><pre>191</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">    }</span></pre></td></tr><tr><td class="line-number"><a href="#L192" name="L192"><pre>192</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L193" name="L193"><pre>193</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre>    func process(_ fnIndex: Int, items: [String]) -&gt; String <span class="red">{</span></pre></td></tr><tr><td class="line-number"><a href="#L194" name="L194"><pre>194</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">        return js.evaluateScript("cutboxFunctions[\(fnIndex)].fn").call(withArguments: [items]).toString()!</span></pre></td></tr><tr><td class="line-number"><a href="#L195" name="L195"><pre>195</pre></a></td><td class="uncovered-line"><pre>0</pre></td><td class="code"><pre><span class="red">    }</span></pre></td></tr><tr><td class="line-number"><a href="#L196" name="L196"><pre>196</pre></a></td><td class="uncovered-line"></td><td class="code"><pre>}</pre></td></tr><tr><td class="line-number"><a href="#L197" name="L197"><pre>197</pre></a></td><td class="uncovered-line"></td><td class="code"><pre></pre></td></tr><tr><td class="line-number"><a href="#L198" name="L198"><pre>198</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>func getStringFromFile(_ expandedFilename: String) -&gt; String? {</pre></td></tr><tr><td class="line-number"><a href="#L199" name="L199"><pre>199</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>    guard let fileContent = try? String(contentsOfFile: expandedFilename)</pre></td></tr><tr><td class="line-number"><a href="#L200" name="L200"><pre>200</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>    else { return nil }</pre></td></tr><tr><td class="line-number"><a href="#L201" name="L201"><pre>201</pre></a></td><td class="covered-line"><pre>1</pre></td><td class="code"><pre>    return fileContent</pre></td></tr><tr><td class="line-number"><a href="#L202" name="L202"><pre>202</pre></a></td><td class="covered-line"><pre>3</pre></td><td class="code"><pre>}</pre></td></tr></table></div></body></html>