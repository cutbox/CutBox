#!/usr/bin/env python3

import os
import sys

def modify_html_report(file_path):
    with open(file_path, 'r') as file:
        content = file.read()

    start_tag = "<div class='source-name-title'><pre>"
    end_tag = '</pre></div>'
    
    start_index = content.find(start_tag)
    end_index = content.find(end_tag, start_index)
    
    while start_index != -1 and end_index != -1:
        original_path = content[start_index + len(start_tag):end_index].strip()
        print(f"found: {original_path}")
        modified_path = original_path.split('/CutBox/')[-1]  # Get portion after /CutBox/

        replacement = f".../CutBox/{modified_path}"
        print(f"modified to: {replacement}")
        content = content[:start_index + len(start_tag)] + replacement + content[end_index:]
        
        start_index = content.find(start_tag, start_index + len(replacement))
        end_index = content.find(end_tag, start_index)

    with open(file_path, 'w') as file:
        file.write(content)

def main():
    if len(sys.argv) != 2:
        print("Usage: {} <reports_root_path>".format(sys.argv[0]))
        sys.exit(1)

    reports_root = sys.argv[1]

    for root, _, files in os.walk(reports_root):
        for file in files:
            if file.endswith('.html'):
                print(f"Checking: {file}")
                file_path = os.path.join(root, file)
                modify_html_report(file_path)

if __name__ == "__main__":
    main()
