#!/bin/sh

message() {
  echo "CutBox Setup: ${1}"
}

WHICH_FAILED=""
WHICH_CHECK=0

which_check() {
  cross_mark="❌"
  check_mark="✓"

  if [ $# -ne 1 ]; then
    message "which_check: No arguments provided"
    exit 1
  else
    if [[ $(which $1) == "$1 not found" ]]; then
      printf "${cross_mark}"
      WHICH_CHECK=1
      WHICH_FAILED="${WHICH_FAILED} ${1}"
    else
      printf "${check_mark}"
    fi
  fi
}

if [[ "$(which brew)" != "brew not found" ]]; then
  message "Running brew bundle & npm install"
  brew bundle
  npm install
else
  message "Homebrew must be installed and working."
  exit 1
fi



echo "PLEASE NOTE: CutBox expects:

Build & release tooling...

- [$(which_check brew)] homebrew (in case anything is missing)
- [$(which_check ruby)] ruby (just for cocoapods)
- [$(which_check pod)] cocoapods

For release...

- [$(which_check cmark)] cmark
- [$(which_check npm)] npm
- [$(which_check appdmg)] appdmg
- [$(which_check semver)] semver
- [$(which_check mustache)] mustache
"
echo "anything missing? (Get help at https://gitter.im/CutBox/Lobby)"

PROJECT_DIR=$(git rev-parse --show-toplevel)

echo "=========================================================================================="
echo "Install Pods"

pushd $PROJECT_DIR/CutBox || exit 1

pod install

popd ||  exit 1

echo "To build run: bin/build"

if [[ $WHICH_CHECK == 1 ]]; then
  echo "Something missing? Setup cannot find: ${WHICH_FAILED}."
  exit 1
fi

exit 0
